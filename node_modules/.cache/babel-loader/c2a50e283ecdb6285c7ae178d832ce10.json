{"ast":null,"code":"(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) : typeof define === 'function' && define.amd ? define(['exports'], factory) : factory(global.d3 = global.d3 || {});\n})(this, function (exports) {\n  'use strict'; // SCALES USED TO INVERT COURT Y COORDS AND MAP SHOOTING PERCENTAGES OF BINS TO A FILL COLOR \n\n  var yScale = d3.scaleLinear().domain([0, 47]).rangeRound([47, 0]);\n\n  function court() {\n    // NBA court dimensions are 50ft sideline to sideline and 94feet baseline to baseline (47ft half court)\n    // Forcing at least a 500x470 ratio for the court in order to paint shots appropriately        \n    var width = 500,\n        height = .94 * width;\n\n    function court(selection) {\n      selection.each(function (data) {\n        // Responsive container for the shotchart\n        d3.select(this).style(\"max-width\", width / 16 + \"em\"); // Select the SVG if it exists\n\n        if (!d3.select(this).selectAll(\"svg\").empty()) {\n          var svg = d3.select(this).selectAll(\"svg\");\n        } else {\n          var svg = d3.select(this).append(\"svg\").attr(\"viewBox\", \"0, 0, \" + 50 + \", \" + 47 + \"\").classed(\"court\", true); // Append the outer paint rectangle\n\n          svg.append(\"g\").classed(\"court-paint\", true).append(\"rect\").attr(\"width\", 16).attr(\"height\", 19).attr(\"x\", 25).attr(\"transform\", \"translate(\" + -8 + \",\" + 0 + \")\").attr(\"y\", yScale(19)); // Append inner paint lines\n\n          svg.append(\"g\").classed(\"inner-court-paint\", true).append(\"line\").attr(\"x1\", 19).attr(\"x2\", 19).attr(\"y1\", yScale(19)).attr(\"y2\", yScale(0));\n          svg.append(\"g\").classed(\"inner-court-paint\", true).append(\"line\").attr(\"x1\", 31).attr(\"x2\", 31).attr(\"y1\", yScale(19)).attr(\"y2\", yScale(0)); // Append foul circle\n          // Add clipPaths w/ rectangles to make the 2 semi-circles with our desired styles\n\n          var dashedFoulCircle = svg.append(\"g\").classed(\"foul-circle dashed\", true);\n          dashedFoulCircle.append(\"defs\").append(\"clipPath\").attr(\"id\", \"cut-off-top\").append(\"rect\").attr(\"width\", 12).attr(\"height\", 6).attr(\"x\", 25).attr(\"y\", yScale(19)) // 47-19 (top of rectangle is pinned to foul line, which is at 19 ft)\n          .attr(\"transform\", \"translate(\" + -6 + \",\" + 0 + \")\");\n          dashedFoulCircle.append(\"circle\").attr(\"cx\", 25).attr(\"cy\", yScale(19)) // 47-19\n          .attr(\"r\", 6).attr(\"stroke-dasharray\", 1 + \",\" + 1).attr(\"clip-path\", \"url(#cut-off-top)\");\n          var solidFoulCircle = svg.append(\"g\").classed(\"foul-circle solid\", true);\n          solidFoulCircle.append(\"defs\").append(\"clipPath\").attr(\"id\", \"cut-off-bottom\").append(\"rect\").attr(\"width\", 12).attr(\"height\", 6).attr(\"x\", 25).attr(\"y\", yScale(19))\n          /*foul line is 19 feet, then transform by 6 feet (circle radius) to pin rectangle above foul line..clip paths only render the parts of the circle that are in the rectangle path */\n          .attr(\"transform\", \"translate(\" + -6 + \",\" + -6 + \")\");\n          solidFoulCircle.append(\"circle\").attr(\"cx\", 25).attr(\"cy\", yScale(19)).attr(\"r\", 6).attr(\"clip-path\", \"url(#cut-off-bottom)\"); // Add backboard and rim\n\n          svg.append(\"g\").classed(\"backboard\", true).append(\"line\").attr(\"x1\", 22).attr(\"x2\", 28).attr(\"y1\", yScale(4)) // 47-4\n          .attr(\"y2\", yScale(4)); // 47-4\n\n          svg.append(\"g\").classed(\"rim\", true).append(\"circle\").attr(\"cx\", 25).attr(\"cy\", yScale(4.75)) // 47-4.75 need to set center point of circle to be 'r' above backboard\n          .attr(\"r\", .75); //regulation rim is 18 inches\n          // Add restricted area -- a 4ft radius circle from the center of the rim\n\n          var restrictedArea = svg.append(\"g\").classed(\"restricted-area\", true);\n          restrictedArea.append(\"defs\").append(\"clipPath\").attr(\"id\", \"restricted-cut-off\").append(\"rect\").attr(\"width\", 8) // width is 2r of the circle it's cutting off\n          .attr(\"height\", 4) // height is 1r of the circle it's cutting off\n          .attr(\"x\", 25) // center rectangle\n          .attr(\"y\", yScale(4.75)).attr(\"transform\", \"translate(\" + -4 + \",\" + -4 + \")\");\n          restrictedArea.append(\"circle\").attr(\"cx\", 25).attr(\"cy\", yScale(4.75)).attr(\"r\", 4).attr(\"clip-path\", \"url(#restricted-cut-off)\");\n          restrictedArea.append(\"line\").attr(\"x1\", 21).attr(\"x2\", 21).attr(\"y1\", yScale(5.25)).attr(\"y2\", yScale(4));\n          restrictedArea.append(\"line\").attr(\"x1\", 29).attr(\"x2\", 29).attr(\"y1\", yScale(5.25)).attr(\"y2\", yScale(4)); // Add 3 point arc\n\n          var threePointArea = svg.append(\"g\").classed(\"three-point-area\", true);\n          threePointArea.append(\"defs\").append(\"clipPath\").attr(\"id\", \"three-point-cut-off\").append(\"rect\").attr(\"width\", 44).attr(\"height\", 23.75).attr(\"x\", 25).attr(\"y\", yScale(4.75)) // put recentagle at centerpoint of circle then translate by the inverse of the circle radius to cut off top half\n          .attr(\"transform\", \"translate(\" + -22 + \",\" + -23.75 + \")\");\n          threePointArea.append(\"circle\").attr(\"cx\", 25).attr(\"cy\", yScale(4.75)).attr(\"r\", 23.75).attr(\"clip-path\", \"url(#three-point-cut-off)\");\n          threePointArea.append(\"line\").attr(\"x1\", 3).attr(\"x2\", 3).attr(\"y1\", yScale(14)).attr(\"y2\", yScale(0));\n          threePointArea.append(\"line\").attr(\"x1\", 47).attr(\"x2\", 47).attr(\"y1\", yScale(14)).attr(\"y2\", yScale(0)); // Add key lines\n\n          var keyLines = svg.append(\"g\").classed(\"key-lines\", true);\n          keyLines.append(\"line\").attr(\"x1\", 16).attr(\"x2\", 17).attr(\"y1\", yScale(7)).attr(\"y2\", yScale(7));\n          keyLines.append(\"line\").attr(\"x1\", 16).attr(\"x2\", 17).attr(\"y1\", yScale(8)).attr(\"y2\", yScale(8));\n          keyLines.append(\"line\").attr(\"x1\", 16).attr(\"x2\", 17).attr(\"y1\", yScale(11)).attr(\"y2\", yScale(11));\n          keyLines.append(\"line\").attr(\"x1\", 16).attr(\"x2\", 17).attr(\"y1\", yScale(14)).attr(\"y2\", yScale(14));\n          keyLines.append(\"line\").attr(\"x1\", 33).attr(\"x2\", 34).attr(\"y1\", yScale(7)).attr(\"y2\", yScale(7));\n          keyLines.append(\"line\").attr(\"x1\", 33).attr(\"x2\", 34).attr(\"y1\", yScale(8)).attr(\"y2\", yScale(8));\n          keyLines.append(\"line\").attr(\"x1\", 33).attr(\"x2\", 34).attr(\"y1\", yScale(11)).attr(\"y2\", yScale(11));\n          keyLines.append(\"line\").attr(\"x1\", 33).attr(\"x2\", 34).attr(\"y1\", yScale(14)).attr(\"y2\", yScale(14)); // Append baseline\n\n          svg.append(\"g\").classed(\"court-baseline\", true).append(\"line\").attr(\"x1\", 0).attr(\"x2\", 50).attr(\"y1\", yScale(0)).attr(\"y2\", yScale(0));\n          svg.append(\"g\").classed(\"shots\", true);\n        }\n\n        ;\n      });\n    }\n\n    ;\n\n    court.width = function (_) {\n      if (!arguments.length) return width;\n      width = _;\n      height = .94 * _;\n      return court;\n    };\n\n    return court;\n  }\n\n  ;\n  var activeDisplay = \"scatter\";\n  var activeTheme = \"day\"; // SCALES USED TO INVERT COURT Y COORDS AND MAP SHOOTING PERCENTAGES OF BINS TO A FILL COLOR \n\n  var yScale$1 = d3.scaleLinear().domain([0, 47]).rangeRound([47, 0]);\n  var percentFormatter = d3.format(\".2%\");\n\n  function shots() {\n    var hexRadiusValues = [.8, 1, 1.2],\n        hexMinShotThreshold = 1,\n        heatScale = d3.scaleQuantize().domain([0, 1]).range(['#5458A2', '#6689BB', '#FADC97', '#F08460', '#B02B48']),\n        hexRadiusScale = d3.scaleQuantize().domain([0, 2]).range(hexRadiusValues),\n        toolTips = false,\n        hexbin = d3_hexbin.hexbin().radius(1.2).x(function (d) {\n      return d.key[0];\n    }) // accessing the x, y coords from the nested json key\n    .y(function (d) {\n      return yScale$1(d.key[1]);\n    });\n\n    var _nestShotsByLocation = function (data) {\n      var nestedData = d3.nest().key(function (d) {\n        return [d.x, d.y];\n      }).rollup(function (v) {\n        return {\n          \"made\": d3.sum(v, function (d) {\n            return d.shot_made_flag;\n          }),\n          \"attempts\": v.length,\n          \"shootingPercentage\": d3.sum(v, function (d) {\n            return d.shot_made_flag;\n          }) / v.length\n        };\n      }).entries(data); // change to use a string split and force cast to int\n\n      nestedData.forEach(function (a) {\n        a.key = JSON.parse(\"[\" + a.key + \"]\");\n      });\n      return nestedData;\n    };\n\n    var _getHexBinShootingStats = function (data, index) {\n      var attempts = d3.sum(data, function (d) {\n        return d.value.attempts;\n      });\n      var makes = d3.sum(data, function (d) {\n        return d.value.made;\n      });\n      var shootingPercentage = makes / attempts;\n      data.shootingPercentage = shootingPercentage;\n      data.attempts = attempts;\n      data.makes = makes;\n      return data;\n    };\n\n    function shots(selection) {\n      selection.each(function (data) {\n        var shotsGroup = d3.select(this).select(\"svg\").select(\".shots\"),\n            legends = d3.select(this).select(\"#legends\"),\n            nestedData = _nestShotsByLocation(data),\n            hexBinCoords = hexbin(nestedData).map(_getHexBinShootingStats);\n\n        if (activeDisplay === \"scatter\") {\n          if (legends.empty() === false) {\n            legends.remove();\n          }\n\n          var shots = shotsGroup.selectAll(\".shot\").data(data, function (d) {\n            return [d.x, d.y];\n          });\n          shots.exit().transition().duration(1000).attr(\"r\", 0).attr(\"d\", hexbin.hexagon(0)).remove();\n\n          if (toolTips) {\n            var tool_tip = d3.tip().attr(\"class\", \"d3-tip\").offset([-8, 0]).html(function (d) {\n              return d.shot_distance + \"' \" + d.action_type;\n            });\n            shotsGroup.call(tool_tip);\n          }\n\n          shots.enter().append(\"circle\").classed(\"shot\", true).classed(\"make\", function (d) {\n            return d.shot_made_flag === 1; // used to set fill color to green if it's a made shot\n          }).classed(\"miss\", function (d) {\n            return d.shot_made_flag === 0; // used to set fill color to red if it's a miss\n          }).attr(\"cx\", function (d) {\n            return d.x;\n          }).attr(\"cy\", function (d) {\n            return yScale$1(d.y);\n          }).attr(\"r\", 0).on('mouseover', function (d) {\n            if (toolTips) {\n              tool_tip.show(d);\n            }\n          }).on('mouseout', function (d) {\n            if (toolTips) {\n              tool_tip.hide(d);\n            }\n          }).transition().duration(1000).attr(\"r\", .5);\n        } else if (activeDisplay === \"hexbin\") {\n          var shots = shotsGroup.selectAll(\".shot\").data(hexBinCoords, function (d) {\n            return [d.x, d.y];\n          });\n          shots.exit().transition().duration(1000).attr(\"r\", 0).attr(\"d\", hexbin.hexagon(0)).remove();\n\n          if (toolTips) {\n            var tool_tip = d3.tip().attr(\"class\", \"d3-tip\").offset([-8, 0]).html(function (d) {\n              return d.makes + \" / \" + d.attempts + \" (\" + percentFormatter(d.shootingPercentage) + \")\";\n            });\n            shotsGroup.call(tool_tip);\n          }\n\n          shots.enter().append(\"path\").classed(\"shot\", true).attr(\"transform\", function (d) {\n            return \"translate(\" + d.x + \",\" + d.y + \")\";\n          }).attr(\"d\", hexbin.hexagon(0)).on('mouseover', function (d) {\n            if (toolTips) {\n              tool_tip.show(d);\n            }\n          }).on('mouseout', function (d) {\n            if (toolTips) {\n              tool_tip.hide(d);\n            }\n          }).transition().duration(1000).attr(\"d\", function (d) {\n            if (d.length >= hexMinShotThreshold) {\n              if (d.length <= 3) {\n                return hexbin.hexagon(hexRadiusScale(0));\n              } else if (3 < d.length && d.length <= 8) {\n                return hexbin.hexagon(hexRadiusScale(1));\n              } else {\n                return hexbin.hexagon(hexRadiusScale(2));\n              }\n            }\n          }).style(\"fill\", function (d) {\n            return heatScale(d.shootingPercentage);\n          }); // CHANGE TO USE SELECTION.EMPTY()\n\n          if (legends.empty() === true) {\n            var legendSVG = d3.select(this).append('svg').attr(\"viewBox\", \"0, 0, \" + 50 + \", \" + 10 + \"\").attr('id', 'legends'),\n                efficiencyLegend = legendSVG.append('g').classed('legend', true),\n                frequencyLegend = legendSVG.append('g').classed('legend', true).classed('frequency', true),\n                frequencyLegendXStart = 7;\n            efficiencyLegend.append(\"text\").classed('legend-text', true).attr(\"x\", 40).attr(\"y\", 5).attr(\"text-anchor\", \"middle\").text(\"Efficiency\");\n            efficiencyLegend.append(\"text\").classed(\"legend-text\", true).attr(\"x\", 34.25).attr(\"y\", 2.5).attr(\"text-anchor\", \"end\").text(\"cold\");\n            efficiencyLegend.append(\"text\").classed(\"legend-text\", true).attr(\"x\", 45.75).attr(\"y\", 2.5).attr(\"text-anchor\", \"start\").text(\"hot\");\n            efficiencyLegend.selectAll('path').data(heatScale.range()).enter().append('path').attr(\"transform\", function (d, i) {\n              return \"translate(\" + (35 + (1 + i * 2) * 1) + \", \" + 2 + \")\";\n            }).attr('d', hexbin.hexagon(0)).transition().duration(1000).attr('d', hexbin.hexagon(1)).style('fill', function (d) {\n              return d;\n            });\n            efficiencyLegend.selectAll(\"text\").style(\"fill\", function () {\n              if (activeTheme === \"night\") {\n                return \"white\";\n              } else if (activeTheme === \"day\") {\n                return \"black\";\n              }\n\n              ;\n            });\n            frequencyLegend.append(\"text\").classed('legend-text', true).attr(\"x\", 10.25).attr(\"y\", 5).attr(\"text-anchor\", \"middle\").text(\"Frequency\");\n            frequencyLegend.append(\"text\").classed(\"legend-text\", true).attr(\"x\", 6.25).attr(\"y\", 2.5).attr(\"text-anchor\", \"end\").text(\"low\");\n            frequencyLegend.selectAll('path').data(hexRadiusValues).enter().append('path').attr(\"transform\", function (d, i) {\n              frequencyLegendXStart += d * 2;\n              return \"translate(\" + (frequencyLegendXStart - d) + \", \" + 2 + \")\";\n            }).attr('d', hexbin.hexagon(0)).transition().duration(1000).attr('d', function (d) {\n              return hexbin.hexagon(d);\n            });\n            frequencyLegend.append(\"text\").classed(\"legend-text\", true).attr(\"x\", 13.75).attr(\"y\", 2.5).attr(\"text-anchor\", \"start\").text(\"high\");\n            frequencyLegend.selectAll(\"text\").style(\"fill\", function () {\n              if (activeTheme === \"night\") {\n                return \"white\";\n              } else if (activeTheme === \"day\") {\n                return \"black\";\n              }\n\n              ;\n            });\n            frequencyLegend.selectAll(\"path\").style(\"fill\", function () {\n              if (activeTheme === \"night\") {\n                return \"none\";\n              } else if (activeTheme === \"day\") {\n                return \"grey\";\n              }\n\n              ;\n            });\n          }\n\n          ;\n        }\n\n        ;\n      });\n    }\n\n    ;\n\n    shots.displayType = function (_) {\n      if (!arguments.length) return activeDisplay;\n      activeDisplay = _;\n      return shots;\n    };\n\n    shots.shotRenderThreshold = function (_) {\n      if (!arguments.length) return hexMinShotThreshold;\n      hexMinShotThreshold = _;\n      return shots;\n    };\n\n    shots.displayToolTips = function (_) {\n      if (!arguments.length) return toolTips;\n      toolTips = _;\n      return shots;\n    };\n\n    shots.theme = function (_) {\n      if (!arguments.length) return activeTheme;\n      activeTheme = _;\n      return shots;\n    };\n\n    return shots;\n  }\n\n  ;\n  exports.court = court;\n  exports.shots = shots;\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n});","map":{"version":3,"sources":["/Users/mango/Documents/Personal/Web/NBA/node_modules/d3-shotchart/build/d3-shotchart.js"],"names":["global","factory","exports","module","define","amd","d3","yScale","scaleLinear","domain","rangeRound","court","width","height","selection","each","data","select","style","selectAll","empty","svg","append","attr","classed","dashedFoulCircle","solidFoulCircle","restrictedArea","threePointArea","keyLines","_","arguments","length","activeDisplay","activeTheme","yScale$1","percentFormatter","format","shots","hexRadiusValues","hexMinShotThreshold","heatScale","scaleQuantize","range","hexRadiusScale","toolTips","hexbin","d3_hexbin","radius","x","d","key","y","_nestShotsByLocation","nestedData","nest","rollup","v","sum","shot_made_flag","entries","forEach","a","JSON","parse","_getHexBinShootingStats","index","attempts","value","makes","made","shootingPercentage","shotsGroup","legends","hexBinCoords","map","remove","exit","transition","duration","hexagon","tool_tip","tip","offset","html","shot_distance","action_type","call","enter","on","show","hide","legendSVG","efficiencyLegend","frequencyLegend","frequencyLegendXStart","text","i","displayType","shotRenderThreshold","displayToolTips","theme","Object","defineProperty"],"mappings":"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","sourcesContent":["(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :\n  typeof define === 'function' && define.amd ? define(['exports'], factory) :\n  (factory((global.d3 = global.d3 || {})));\n}(this, function (exports) { 'use strict';\n\n  // SCALES USED TO INVERT COURT Y COORDS AND MAP SHOOTING PERCENTAGES OF BINS TO A FILL COLOR \n  var yScale = d3.scaleLinear().domain([0, 47]).rangeRound([47, 0]);\n\n  function court() {\n      // NBA court dimensions are 50ft sideline to sideline and 94feet baseline to baseline (47ft half court)\n      // Forcing at least a 500x470 ratio for the court in order to paint shots appropriately        \n      var width = 500,\n          height = .94 * width;\n\n      function court(selection){\n          \n          selection.each(function(data){\n              // Responsive container for the shotchart\n              d3.select(this).style(\"max-width\", width/16 + \"em\");\n              // Select the SVG if it exists\n              if (!d3.select(this).selectAll(\"svg\").empty()){\n                  var svg = d3.select(this).selectAll(\"svg\");\n              }\n              else {\n                  var svg = d3.select(this).append(\"svg\")\n                      .attr(\"viewBox\", \"0, 0, \" + 50 + \", \" + 47 + \"\")\n                      .classed(\"court\", true);\n              // Append the outer paint rectangle\n                  svg.append(\"g\")\n                      .classed(\"court-paint\", true)\n                      .append(\"rect\")\n                      .attr(\"width\", 16)\n                      .attr(\"height\", 19) \n                      .attr(\"x\", 25)\n                      .attr(\"transform\", \"translate(\" + -8 + \",\" + 0 + \")\")\n                      .attr(\"y\", yScale(19));\n                  // Append inner paint lines\n                  svg.append(\"g\")\n                      .classed(\"inner-court-paint\", true)\n                      .append(\"line\")\n                      .attr(\"x1\", 19)\n                      .attr(\"x2\", 19)\n                      .attr(\"y1\", yScale(19))\n                      .attr(\"y2\", yScale(0));\n                  svg.append(\"g\")\n                      .classed(\"inner-court-paint\", true)\n                      .append(\"line\")        \n                      .attr(\"x1\", 31)\n                      .attr(\"x2\", 31)\n                      .attr(\"y1\", yScale(19))\n                      .attr(\"y2\", yScale(0));\n                  // Append foul circle\n                  // Add clipPaths w/ rectangles to make the 2 semi-circles with our desired styles\n                  var dashedFoulCircle = svg.append(\"g\").classed(\"foul-circle dashed\", true);\n                  dashedFoulCircle.append(\"defs\").append(\"clipPath\")\n                      .attr(\"id\", \"cut-off-top\")\n                      .append(\"rect\")\n                      .attr(\"width\", 12)\n                      .attr(\"height\", 6) \n                      .attr(\"x\", 25)\n                      .attr(\"y\", yScale(19)) // 47-19 (top of rectangle is pinned to foul line, which is at 19 ft)\n                      .attr(\"transform\", \"translate(\" + -6 + \",\" + 0 + \")\");\n                  dashedFoulCircle.append(\"circle\")\n                      .attr(\"cx\", 25)\n                      .attr(\"cy\", yScale(19)) // 47-19\n                      .attr(\"r\", 6)\n                      .attr(\"stroke-dasharray\", 1 + \",\" + 1)\n                      .attr(\"clip-path\", \"url(#cut-off-top)\");\n                  var solidFoulCircle = svg.append(\"g\").classed(\"foul-circle solid\", true);\n                  solidFoulCircle.append(\"defs\").append(\"clipPath\")\n                      .attr(\"id\", \"cut-off-bottom\")\n                      .append(\"rect\")\n                      .attr(\"width\", 12)\n                      .attr(\"height\", 6) \n                      .attr(\"x\", 25)\n                      .attr(\"y\", yScale(19)) /*foul line is 19 feet, then transform by 6 feet (circle radius) to pin rectangle above foul line..clip paths only render the parts of the circle that are in the rectangle path */\n                      .attr(\"transform\", \"translate(\" + -6 + \",\" + -6 + \")\");\n                  solidFoulCircle.append(\"circle\")\n                      .attr(\"cx\", 25)\n                      .attr(\"cy\", yScale(19))\n                      .attr(\"r\", 6)\n                      .attr(\"clip-path\", \"url(#cut-off-bottom)\");\n                  // Add backboard and rim\n                  svg.append(\"g\").classed(\"backboard\", true)\n                      .append(\"line\")        \n                      .attr(\"x1\", 22)\n                      .attr(\"x2\", 28)\n                      .attr(\"y1\", yScale(4)) // 47-4\n                      .attr(\"y2\", yScale(4)); // 47-4\n                  svg.append(\"g\").classed(\"rim\", true)\n                      .append(\"circle\")\n                      .attr(\"cx\", 25)\n                      .attr(\"cy\", yScale(4.75)) // 47-4.75 need to set center point of circle to be 'r' above backboard\n                      .attr(\"r\", .75); //regulation rim is 18 inches\n                  // Add restricted area -- a 4ft radius circle from the center of the rim\n                  var restrictedArea = svg.append(\"g\").classed(\"restricted-area\", true);\n                  restrictedArea.append(\"defs\").append(\"clipPath\")\n                      .attr(\"id\", \"restricted-cut-off\")\n                      .append(\"rect\")\n                      .attr(\"width\", 8) // width is 2r of the circle it's cutting off\n                      .attr(\"height\", 4) // height is 1r of the circle it's cutting off\n                      .attr(\"x\", 25) // center rectangle\n                      .attr(\"y\", yScale(4.75))\n                      .attr(\"transform\", \"translate(\" + -4 + \",\" + -4 + \")\");\n                  restrictedArea.append(\"circle\")\n                      .attr(\"cx\", 25)\n                      .attr(\"cy\", yScale(4.75))\n                      .attr(\"r\", 4)\n                      .attr(\"clip-path\", \"url(#restricted-cut-off)\");\n                  restrictedArea.append(\"line\")\n                      .attr(\"x1\", 21)\n                      .attr(\"x2\", 21)\n                      .attr(\"y1\", yScale(5.25))\n                      .attr(\"y2\", yScale(4));\n                  restrictedArea.append(\"line\")\n                      .attr(\"x1\", 29)\n                      .attr(\"x2\", 29)\n                      .attr(\"y1\", yScale(5.25))\n                      .attr(\"y2\", yScale(4));\n                  // Add 3 point arc\n                  var threePointArea = svg.append(\"g\").classed(\"three-point-area\", true);\n                  threePointArea.append(\"defs\").append(\"clipPath\")\n                      .attr(\"id\", \"three-point-cut-off\")\n                      .append(\"rect\")\n                      .attr(\"width\", 44)\n                      .attr(\"height\", 23.75)\n                      .attr(\"x\", 25)\n                      .attr(\"y\", yScale(4.75)) // put recentagle at centerpoint of circle then translate by the inverse of the circle radius to cut off top half\n                      .attr(\"transform\", \"translate(\" + -22 + \",\" + -23.75 + \")\");                \n                  threePointArea.append(\"circle\")\n                      .attr(\"cx\", 25)\n                      .attr(\"cy\", yScale(4.75))\n                      .attr(\"r\", 23.75)\n                      .attr(\"clip-path\", \"url(#three-point-cut-off)\");                   \n                  threePointArea.append(\"line\")\n                      .attr(\"x1\", 3)\n                      .attr(\"x2\", 3)\n                      .attr(\"y1\", yScale(14))\n                      .attr(\"y2\", yScale(0));\n                  threePointArea.append(\"line\")\n                      .attr(\"x1\", 47)\n                      .attr(\"x2\", 47)\n                      .attr(\"y1\", yScale(14))\n                      .attr(\"y2\", yScale(0)); \n                  // Add key lines\n                  var keyLines = svg.append(\"g\").classed(\"key-lines\", true);\n                  keyLines.append(\"line\")\n                      .attr(\"x1\", 16)\n                      .attr(\"x2\", 17)\n                      .attr(\"y1\", yScale(7))\n                      .attr(\"y2\", yScale(7));\n                  keyLines.append(\"line\")\n                      .attr(\"x1\", 16)\n                      .attr(\"x2\", 17)\n                      .attr(\"y1\", yScale(8))\n                      .attr(\"y2\", yScale(8));\n                  keyLines.append(\"line\")\n                      .attr(\"x1\", 16)\n                      .attr(\"x2\", 17)\n                      .attr(\"y1\", yScale(11))\n                      .attr(\"y2\", yScale(11));\n                  keyLines.append(\"line\")\n                      .attr(\"x1\", 16)\n                      .attr(\"x2\", 17)\n                      .attr(\"y1\", yScale(14))\n                      .attr(\"y2\", yScale(14));\n                  keyLines.append(\"line\")\n                      .attr(\"x1\", 33)\n                      .attr(\"x2\", 34)\n                      .attr(\"y1\", yScale(7))\n                      .attr(\"y2\", yScale(7));\n                  keyLines.append(\"line\")\n                      .attr(\"x1\", 33)\n                      .attr(\"x2\", 34)\n                      .attr(\"y1\", yScale(8))\n                      .attr(\"y2\", yScale(8));\n                  keyLines.append(\"line\")\n                      .attr(\"x1\", 33)\n                      .attr(\"x2\", 34)\n                      .attr(\"y1\", yScale(11))\n                      .attr(\"y2\", yScale(11));\n                  keyLines.append(\"line\")\n                      .attr(\"x1\", 33)\n                      .attr(\"x2\", 34)\n                      .attr(\"y1\", yScale(14))\n                      .attr(\"y2\", yScale(14));\n                  // Append baseline\n                  svg.append(\"g\")\n                      .classed(\"court-baseline\", true)\n                      .append(\"line\")\n                      .attr(\"x1\", 0)\n                      .attr(\"x2\", 50)\n                      .attr(\"y1\", yScale(0))\n                      .attr(\"y2\", yScale(0)); \n\n                  svg.append(\"g\").classed(\"shots\", true);\n                  \n              };            \n          });\n      };\n\n    court.width = function(_) {\n      if (!arguments.length) return width;\n      width = _;\n      height = .94 * _;\n      return court;\n    };\n\n      return court;\n  };\n\n  var activeDisplay = \"scatter\";\n  var activeTheme = \"day\";\n  // SCALES USED TO INVERT COURT Y COORDS AND MAP SHOOTING PERCENTAGES OF BINS TO A FILL COLOR \n  var yScale$1 = d3.scaleLinear().domain([0, 47]).rangeRound([47, 0]);\n  var percentFormatter = d3.format(\".2%\");\n\n  function shots() {\n      \n      var hexRadiusValues = [.8, 1, 1.2],\n          hexMinShotThreshold = 1,\n          heatScale = d3.scaleQuantize().domain([0, 1]).range(['#5458A2', '#6689BB', '#FADC97', '#F08460', '#B02B48']),\n          hexRadiusScale = d3.scaleQuantize().domain([0, 2]).range(hexRadiusValues),\n          toolTips = false,\n          hexbin = d3_hexbin.hexbin()\n                  .radius(1.2)\n                  .x(function(d) { return d.key[0]; }) // accessing the x, y coords from the nested json key\n                  .y(function(d) { return yScale$1(d.key[1]); });        \n      \n      var _nestShotsByLocation = function(data) {\n          var nestedData = d3.nest()\n              .key(function(d) {\n                  return [d.x, d.y];\n              })\n              .rollup(function(v) { return {\n                  \"made\": d3.sum(v, function(d) { return d.shot_made_flag }),\n                  \"attempts\": v.length,\n                  \"shootingPercentage\":  d3.sum(v, function(d) { return d.shot_made_flag })/v.length\n              }})\n              .entries(data);\n          // change to use a string split and force cast to int\n          nestedData.forEach(function(a){\n              a.key = JSON.parse(\"[\" + a.key + \"]\");\n          });\n\n          return nestedData;\n      };\n\n      var _getHexBinShootingStats = function(data, index) {\n          var attempts = d3.sum(data, function(d) { return d.value.attempts; })\n          var makes = d3.sum(data, function(d) { return d.value.made; })\n          var shootingPercentage = makes/attempts;\n          data.shootingPercentage = shootingPercentage;\n          data.attempts = attempts;\n          data.makes = makes;\n          return data;\n      };\n      \n\n      function shots(selection){\n\n          selection.each(function(data){\n\n              var shotsGroup = d3.select(this).select(\"svg\").select(\".shots\"),\n                  legends = d3.select(this).select(\"#legends\"),\n                  nestedData = _nestShotsByLocation(data),\n                  hexBinCoords = hexbin(nestedData).map(_getHexBinShootingStats);\n\n              if (activeDisplay === \"scatter\"){\n                  if (legends.empty() === false){\n                      legends.remove();\n                  }\n                  \n                  var shots = shotsGroup.selectAll(\".shot\")\n                                      .data(data, function(d){ return [d.x, d.y]; });\n                  shots.exit()\n                      .transition().duration(1000)\n                      .attr(\"r\", 0)\n                      .attr(\"d\", hexbin.hexagon(0))\n                      .remove();\n\n                  if (toolTips) {\n                      var tool_tip = d3.tip()\n                        .attr(\"class\", \"d3-tip\")\n                        .offset([-8, 0])\n                        .html(function(d) { \n                              return d.shot_distance + \"' \" + d.action_type; \n                          });\n                      \n                      shotsGroup.call(tool_tip);\n                  }\n\n                  shots.enter()\n                      .append(\"circle\")\n                      .classed(\"shot\", true)\n                      .classed(\"make\", function(d){\n                            return d.shot_made_flag === 1; // used to set fill color to green if it's a made shot\n                      })\n                      .classed(\"miss\", function(d){\n                            return d.shot_made_flag === 0; // used to set fill color to red if it's a miss\n                      })\n                      .attr(\"cx\", function(d) { return d.x; })\n                      .attr(\"cy\", function(d) { return yScale$1(d.y); })\n                      .attr(\"r\", 0)\n                      .on('mouseover', function(d) { if (toolTips) {tool_tip.show(d);} })\n                      .on('mouseout', function(d) { if (toolTips) {tool_tip.hide(d);} })\n                      .transition().duration(1000)\n                      .attr(\"r\", .5);\n                  \n              }\n              else if (activeDisplay === \"hexbin\"){\n\n                  var shots = shotsGroup.selectAll(\".shot\")\n                                      .data(hexBinCoords, function(d){ return [d.x, d.y]; });\n\n                  shots.exit()\n                      .transition().duration(1000)\n                      .attr(\"r\", 0)\n                      .attr(\"d\", hexbin.hexagon(0))                \n                      .remove();\n                  \n                  if (toolTips) {\n                      var tool_tip = d3.tip()\n                        .attr(\"class\", \"d3-tip\")\n                        .offset([-8, 0])\n                        .html(function(d) { \n                              return d.makes + \" / \" + d.attempts + \" (\" + percentFormatter(d.shootingPercentage) + \")\"; \n                          });\n                      \n                      shotsGroup.call(tool_tip);\n                  }\n\n                  shots.enter()                \n                      .append(\"path\")\n                      .classed(\"shot\", true)\n                      .attr(\"transform\", function(d) { return \"translate(\" + d.x + \",\" + d.y + \")\"; })\n                      .attr(\"d\", hexbin.hexagon(0))\n                      .on('mouseover', function(d) { if (toolTips) {tool_tip.show(d);} })\n                      .on('mouseout', function(d) { if (toolTips) {tool_tip.hide(d);} })\n                      .transition().duration(1000)\n                      .attr(\"d\", function(d) { \n                                  if (d.length >= hexMinShotThreshold) {\n                                      if (d.length <= 3){\n                                          return hexbin.hexagon(hexRadiusScale(0));\n                                      }\n                                      else if (3 < d.length && d.length <= 8){\n                                          return hexbin.hexagon(hexRadiusScale(1));\n                                      }\n                                      else {\n                                          return hexbin.hexagon(hexRadiusScale(2));\n                                      }\n                                  } \n                              })\n                      .style(\"fill\", function(d) { return heatScale(d.shootingPercentage); });\n                  \n                  // CHANGE TO USE SELECTION.EMPTY()\n                  if (legends.empty() === true){\n                      var legendSVG = d3.select(this).append('svg').attr(\"viewBox\", \"0, 0, \" + 50 + \", \" + 10 + \"\").attr('id', 'legends'),\n                          efficiencyLegend = legendSVG.append('g').classed('legend', true),\n                          frequencyLegend = legendSVG.append('g').classed('legend', true)\n                                                              .classed('frequency', true),\n                          frequencyLegendXStart = 7;\n\n                      efficiencyLegend.append(\"text\")\n                                      .classed('legend-text', true)\n                                      .attr(\"x\", 40)             \n                                      .attr(\"y\", 5)\n                                      .attr(\"text-anchor\", \"middle\") \n                                      .text(\"Efficiency\");\n                      efficiencyLegend.append(\"text\")\n                                      .classed(\"legend-text\", true)\n                                      .attr(\"x\", 34.25)             \n                                      .attr(\"y\", 2.5)\n                                      .attr(\"text-anchor\", \"end\") \n                                      .text(\"cold\");\n                      efficiencyLegend.append(\"text\")\n                                      .classed(\"legend-text\", true)\n                                      .attr(\"x\", 45.75)             \n                                      .attr(\"y\", 2.5)\n                                      .attr(\"text-anchor\", \"start\") \n                                      .text(\"hot\");\n                      efficiencyLegend.selectAll('path').data(heatScale.range())\n                                      .enter()\n                                      .append('path')\n                                      .attr(\"transform\", function (d, i) {\n                                        return \"translate(\" + \n                                          (35 + ((1 + i*2) * 1)) + \", \" + 2 + \")\";\n                                      })\n                                      .attr('d', hexbin.hexagon(0))\n                                      .transition().duration(1000)\n                                      .attr('d', hexbin.hexagon(1))\n                                      .style('fill', function (d) { return d; });\n                      efficiencyLegend.selectAll(\"text\").style(\"fill\", function(){ \n                                          if (activeTheme === \"night\"){ return \"white\"; }\n                                          else if (activeTheme === \"day\"){ return \"black\"; };\n                                      });\n                      \n                      frequencyLegend.append(\"text\")\n                                      .classed('legend-text', true)\n                                      .attr(\"x\", 10.25)             \n                                      .attr(\"y\", 5)\n                                      .attr(\"text-anchor\", \"middle\")  \n                                      .text(\"Frequency\");\n                      frequencyLegend.append(\"text\")\n                                      .classed(\"legend-text\", true)\n                                      .attr(\"x\", 6.25)             \n                                      .attr(\"y\", 2.5)\n                                      .attr(\"text-anchor\", \"end\")  \n                                      .text(\"low\");\n                      frequencyLegend.selectAll('path').data(hexRadiusValues)\n                                      .enter()\n                                      .append('path')\n                                      .attr(\"transform\", function (d, i) {\n                                          frequencyLegendXStart += d * 2;\n                                          return \"translate(\" + (frequencyLegendXStart - d) + \", \" + 2 + \")\";\n                                      })\n                                      .attr('d', hexbin.hexagon(0))\n                                      .transition().duration(1000)\n                                      .attr('d', function (d) { return hexbin.hexagon(d); })\n                      frequencyLegend.append(\"text\")\n                                      .classed(\"legend-text\", true)\n                                      .attr(\"x\", 13.75)             \n                                      .attr(\"y\", 2.5)\n                                      .attr(\"text-anchor\", \"start\")  \n                                      .text(\"high\");\n                      \n                      frequencyLegend.selectAll(\"text\").style(\"fill\", function(){ \n                                          if (activeTheme === \"night\"){ return \"white\"; }\n                                          else if (activeTheme === \"day\"){ return \"black\"; };\n                                      })\n                      frequencyLegend.selectAll(\"path\").style(\"fill\", function(){ \n                                          if (activeTheme === \"night\"){ return \"none\"; }\n                                          else if (activeTheme === \"day\"){ return \"grey\"; };\n                                      });\n                  };                                                      \n              };\n          });\n      };\n    \n    shots.displayType = function(_) {\n      if (!arguments.length) return activeDisplay;\n      activeDisplay = _;\n      return shots;\n    };\n    \n    shots.shotRenderThreshold = function(_) {\n      if (!arguments.length) return hexMinShotThreshold;\n      hexMinShotThreshold = _;\n      return shots;\n    }; \n    \n    shots.displayToolTips = function(_) {\n      if (!arguments.length) return toolTips;\n      toolTips = _;\n      return shots;\n    };\n\n    shots.theme = function(_) {\n      if (!arguments.length) return activeTheme;\n      activeTheme = _;\n      return shots;\n    };\n\n\n      return shots;\n  };\n\n  exports.court = court;\n  exports.shots = shots;\n\n  Object.defineProperty(exports, '__esModule', { value: true });\n\n}));"]},"metadata":{},"sourceType":"script"}